# 更新日志

## 2025-04-03: 改进意图重置机制

### 问题描述
当用户输入非GMP相关内容时，意图检测器未能正确重置之前检测到的意图，导致错误保留了旧的意图状态。

### 改进内容
1. 修改 `_invoke` 方法，优化检测GMP相关内容的逻辑：
   - 之前的实现检查所有用户消息是否包含GMP相关内容
   - 现在仅检查最近一条用户消息是否包含GMP相关内容
   - 当最近一条用户消息不包含GMP相关内容时，重置之前检测到的意图

2. 改进重置条件：
   - 当没有检测到意图时重置
   - 当意图置信度低于0.3时重置
   - 当最近一条用户消息不包含GMP相关内容时重置

3. 在重置结果中添加明确的`reset`标志：
   ```json
   {
     "success": true,
     "intent_result": {
       "has_intent": false,
       "intent_type": null,
       "confidence": 0.0,
       "matched_keywords": [],
       "reset": true
     }
   }
   ```

### 测试验证
开发了多个测试脚本来验证功能：
- 基本测试：验证不同类型消息的意图检测
- 集成测试：验证完整对话流程中的重置机制
- 简化测试：直接测试核心逻辑

测试结果表明，改进后的重置机制在所有测试场景中都能正确工作：
- 纯GMP内容：正确保留意图
- 纯非GMP内容：正确重置意图
- 混合内容，最后非GMP：正确重置意图
- 混合内容，最后是GMP下载：正确保留意图 